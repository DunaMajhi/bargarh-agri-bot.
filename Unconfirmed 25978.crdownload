
import streamlit as st
import google.generativeai as genai
import json

st.set_page_config(page_title="Bargarh Agri-Bot", page_icon="ğŸŒ¾")

@st.cache_data
def load_data():
    with open('diseases.json', 'r') as f:
        return json.load(f)

knowledge_base = load_data()

# Use the key hardcoded for now to avoid re-typing
api_key = "AIzaSyCNGzchcVOnhXPDrAaqedHcY8fs52hLMOg"

st.title("ğŸŒ¾ Bargarh Krishi Sahayak")
user_query = st.text_area("Describe the problem:", placeholder="Example: Grains are empty and smell bad")

if st.button("ğŸ” Diagnose"):
    if "PASTE" in api_key or len(api_key) < 10:
        st.error("âš ï¸ You forgot to paste your API Key in the code block!")
    else:
        genai.configure(api_key=api_key)
        model = genai.GenerativeModel('gemini-2.0-flash')
        with st.spinner("Thinking..."):
            prompt = f"Role: Bargarh Agri Expert. Database: {json.dumps(knowledge_base)}. User Input: '{user_query}'. Output: Markdown Diagnosis & Prescription."
            try:
                response = model.generate_content(prompt)
                st.markdown(response.text)
            except Exception as e:
                st.error(f"Error: {e}")
